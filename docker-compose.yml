version: "3"

services:
  hexo-build:
    image: linguochi/hexo-build
    container_name: hexo-build
    volumes:
      - /opt:/app

  lingc-webhook:
    image: linguochi/lingc-webhook
    container_name: lingc-webhook
    volumes:
      - /opt:/app

  qinglong:
    image: whyour/qinglong:latest
    container_name: qinglong
    volumes:
      - /opt/qinglong/data/config:/ql/config
      - /opt/qinglong/data/log:/ql/log
      - /opt/qinglong/data/db:/ql/db
      - /opt/qinglong/data/scripts:/ql/scripts
      - /opt/qinglong/data/repo:/ql/repo
    ports:
      - "5700:5700"
    environment:
      - ENABLE_HANGUP=true
      - ENABLE_WEB_PANEL=true

  acme:
    image: neilpang/acme.sh
    container_name: acme
    restart: unless-stopped
    environment:
      - DP_Id=268714
      - DP_Key=806c61d86f03c42caa1987e8e9de5344
      - DEPLOY_DOCKER_CONTAINER_LABEL=docker_nginx
      - DEPLOY_DOCKER_CONTAINER_KEY_FILE=/etc/nginx/ssl/*.linguochi.com/*.linguochi.com.key
      - DEPLOY_DOCKER_CONTAINER_FULLCHAIN_FILE=/etc/nginx/ssl/*.linguochi.com/fullchain.cer
      - DEPLOY_DOCKER_CONTAINER_RELOAD_CMD=nginx -s reload
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /opt/nginx/acme.sh:/acme.sh
      - /opt/nginx/ssl:/etc/nginx/ssl
    command: daemon

  bark-server:
    image: finab/bark-server
    container_name: bark-server
    restart: always
    volumes:
      - ./data:/data
    ports:
      - "8080:8080"

  nginx:
    image: nginx
    container_name: nginx
    privileged: true
    restart: always
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
      - /var/www/html:/var/www/html
      - /opt/hexo-blog:/var/www/html/hexo-blog
      - /opt/nginx/ssl:/etc/nginx/ssl
      - /opt/nginx/logs:/var/log/nginx
    links:
      - qinglong
    ports:
      - "80:80"
      - "443:443"
    labels:
      - docker_nginx
