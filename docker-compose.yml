version: "3"

services:
  hexo-build:
    image: linguochi/hexo-build
    container_name: hexo-build
    volumes:
      - /opt:/app

  lingc-webhook:
    image: linguochi/lingc-webhook
    container_name: lingc-webhook
    volumes:
      - /opt:/app

  qinglong:
    image: whyour/qinglong:latest
    container_name: qinglong
    volumes:
      - /opt/qinglong/data/config:/ql/config
      - /opt/qinglong/data/log:/ql/log
      - /opt/qinglong/data/db:/ql/db
      - /opt/qinglong/data/scripts:/ql/scripts
      - /opt/qinglong/data/repo:/ql/repo
    ports:
      - "5700:5700"
    environment:
      - ENABLE_HANGUP=true
      - ENABLE_WEB_PANEL=true

  acme:
    image: neilpang/acme.sh
    container_name: acme
    restart: unless-stopped
    environment:
      - DP_Id=268714
      - DP_Key=806c61d86f03c42caa1987e8e9de5344
      - DEPLOY_DOCKER_CONTAINER_LABEL=docker_nginx
      - DEPLOY_DOCKER_CONTAINER_KEY_FILE=/etc/nginx/ssl/*.linguochi.com/*.linguochi.com.key
      - DEPLOY_DOCKER_CONTAINER_FULLCHAIN_FILE=/etc/nginx/ssl/*.linguochi.com/fullchain.cer
      - DEPLOY_DOCKER_CONTAINER_RELOAD_CMD=nginx -s reload
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /opt/nginx/acme.sh:/acme.sh
      - /opt/nginx/ssl:/etc/nginx/ssl
    command: daemon

  bark-server:
    image: finab/bark-server
    container_name: bark-server
    restart: always
    volumes:
      - ./data:/data
    ports:
      - "8080:8080"

  aria2:
    image: p3terx/aria2-pro
    container_name: aria2
    logging:
      options:
        max-size: 1m
    ports:
      - "6800:6800"
      - "6888:6888"
      - "6888:6888/udp"
    environment:
      - PUID=${CLOUDREVE_PUID}
      - PGID=${CLOUDREVE_PGID}
      - RPC_SECRET=${ARIA2_RPC_SECRET}
    volumes:
      - ${ARIA2_CONFIG_PATH}:/config
      - ${TEMP_FOLDER_PATH}:/downloads
    restart: unless-stopped

  cloudreve:
    image: xavierniu/cloudreve:sha-7e00890
    container_name: cloudreve
    env_file:
      - ./.env
    environment:
      - PUID=${CLOUDREVE_PUID}
      - PGID=${CLOUDREVE_PGID}
    volumes:
      - ${CLOUDREVE_UPLOAD_PATH}:/cloudreve/uploads
      - ${TEMP_FOLDER_PATH}:/downloads
      - ${CLOUDREVE_CONF_PATH}:/cloudreve/config
      - ${CLOUDREVE_DB_PATH}:/cloudreve/db
      - ${CLOUDREVE_AVATAR_PATH}:/cloudreve/avatar

  wizserver:
    container_name: wizserver
    build: ./wizserver
    restart: always
    ports:
      - "9269:9269/udp"
    volumes:
      - /opt/wizdata:/wiz/storage
      - /etc/localtime:/etc/localtime

  fileview:
    container_name: fileview
    image: keking/kkfileview
    restart: always

  nginx:
    image: nginx
    container_name: nginx
    privileged: true
    restart: always
    volumes:
      - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro
      - /var/www/html:/var/www/html
      - ./nginx:/etc/nginx/conf.d
      - /opt/hexo-blog:/var/www/html/hexo-blog
      - /opt/nginx/ssl:/etc/nginx/ssl
      - /opt/nginx/logs:/var/log/nginx
    links:
      - qinglong
    ports:
      - "80:80"
      - "443:443"
    labels:
      - docker_nginx
